<html>
<head>
	<title>背景列表</title>
	<link rel="stylesheet" href="./css/global.css">
	<link rel="stylesheet" href="./css/ninpo-card.css">
	<script src="./js/jquery-3.6.0.min.js"></script>
	<script src="./js/authenticator.js"></script>
	<script src="./js/myFilter.js"></script>
	<script src="./js/myFilterOptionBuilder.js"></script>
	<script src="./data/background-list.js"></script>
	<script src="./js/background-filter.js"></script>
	<script src="./js/background-parser.js"></script>
	<style>
		#storageContainer{
			background:#884C3A;
			padding: 10px 0;
		}
		#storageContainer .container_title {
			background: #5c0000;
			color:white;
			margin:0 5px;
			padding:5px 10px;
			font-weight:bold;
		}
		#storageContainer .container_title:after {
			content: "(雙擊忍法以加入/移除忍法倉庫)";
			margin: 0 5px;
			font-size: 10px;
			font-weight:normal;
		}
	</style>
	<script>
		var BACKGROUND_LIST;  //from "data/background-list.js"
		var BgFilter; //from "js/ninpo-filter.js"
		var BgOptionBuilder;

		BgFilter.SetList(BACKGROUND_LIST);

		function searchText(){
			var text = $("#searchInput").val();
			BgFilter.SetConfigEntry('text', text);
			printResult();
		}

		function buildFilterOptionsList(){
			BgOptionBuilder.Build(".AdvancedFilterBar")
		}
		function toggleAdvancedFilterArea(){
			$(".AdvancedFilterBar").toggle(200)
		}
		function toggleDisplayMode(){
			printResult();
		}

		function printResult(){
			var isListMode = document.getElementById("displayMode").checked;
			var mode = (isListMode)? 'list': 'card';

			var container = $('#ninpoContainer');
			container.empty();
			i=0;
			for(var ninpoObj of BgFilter.Execute()){
				var ninpoElem = $(parseBackgroundInfo(ninpoObj, mode)).appendTo('#ninpoContainer').get(0);
				ninpoElem.ondblclick = storeNinpo.bind(null, ninpoObj)
			}
		}
		function storeNinpo(ninpoObj){
			var ninpoElem = $(parseBackgroundInfo(ninpoObj, 'list')).appendTo('#storageContainer').get(0);
			ninpoElem.ondblclick = removeNinpo.bind(null, ninpoElem);
		}
		function removeNinpo(selfObj){
			$(selfObj).remove();
		}

		window.onload = function(){
			$("#searchInput").on('search', function(e){
				searchText();
			})
			buildFilterOptionsList();
			printResult()
		}
		window.addEventListener('selectFilterOption', function(e){
			NinpoFilter.toggleOption(e.detail.type, e.detail.value);
			printResult()
		});
		window.addEventListener('selectFilterGroup', function(e){
			NinpoFilter.toggleGroupOption(e.detail.arr, e.detail.isFolding);
			printResult()
		});
	</script>
</head>
<body>
	<h1>背景列表</h1>
	<div class="SearchPanel">
		<div class="SearchBar Bar">
			<button id="AdvancedSeatchBtn" onclick="toggleAdvancedFilterArea()">▼ 進階搜尋</button>
			<form class="SearchBox" onsubmit="event.preventDefault();" role="search">
				<input id="searchInput" type="search" placeholder="尋找背景名或效果..." autofocus />
				<button id="SearchBtn" type="submit">尋找</button>
			</form>
			<div class="SwitchBlock">
				<span class="label">啟用簡表</span>
				<label class="switch">
					<input id="displayMode" type="checkbox" onChange="toggleDisplayMode()">
					<span class="slider"></span>
				</label>
			</div>
		</div>
		<div class="AdvancedFilterBar"></div>
	</div>
	<div id="storageContainer" class="container">
		<span class="container_title">背景倉庫</span>
	</div>
	<hr>
	<div id="ninpoContainer" class="container"></div>




</body>
</html>